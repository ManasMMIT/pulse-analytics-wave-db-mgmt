### OLD, WORST QUERY
# fetch all these flat collections and map them together
# using complicated business logic on the frontend

query regionalTargetingQuery {
  qualityOfAccessScore {
    _id
    access
    accessTiny
    score
    color
    sortOrder
    caption
  }
  payerHistoricalPolicyLinks {
    _id
    slug
    organization
    coverage
    book
    regimen
    link
    month
    year
  }
  payerHistoricalQualityAccess {
    _id
    slug
    organization
    indication
    population
    subPopulation
    line
    regimen
    access
    tier
    tierRating
    coverage
    book
    year
    month
  }
  payerHistoricalStateLives {
    _id
    slug
    parentSlug
    organization
    state
    stateLong
    managedMedicaidMedical
    managedMedicaidPharmacy
    ffsMedicaidMedical
    ffsMedicaidPharmacy
    otherPharmacy
    totalMedical
    commercialMedical
    medicareMedical
    totalPharmacy
    commercialPharmacy
    medicarePharmacy
    ffsMedicaidMedical
    ffsMedicaidPharmacy
    macMedical
    tricareMedical
    tricarePharmacy
    vaMedical
    vaPharmacy
    year
    month
  }
  clientRegions {
    _id
    client
    state
    region
  }
}

### BETTER QUERY
# This represents the idea of a user on the frontend having a "bag of
# permissions" for a given piece of content, and the developer deciding
# which permissions to apply toward the data that's fetched for the content.

query RegionalTargetingQuery($regionalBreakdown: [JSON]) {
  payerRegionalTargeting(regionalBreakdown: $regionalBreakdown) {
    indication
    population
    line
    regimen
    book
    coverage
    treatmentPlan
    auditedLives
    totalLives
    auditedLivesPercent
    livesType
    regionalData
    states
  }
}

### BEST QUERY
# The backend knows who the user is; it can fetch that user's region
# before proceeding with data manipulation; the endpoint is specific
# to a given piece of content, so it knows that for User X who is fetching
# content Y, it needs to use permission set Z

query RegionalTargetingQuery {
  payerRegionalTargeting {
    indication
    population
    line
    regimen
    book
    coverage
    treatmentPlan
    auditedLives
    totalLives
    auditedLivesPercent
    livesType
    regionalData
    states
  }
}
